<script type="text/javascript">
<!--

function valideSaisieCso(laForm, action) {
	// test obligation sur titre, entete, debut, fin, question 0
	var message="Les données suivantes sont incorrectes : ";
	var suite=true;
	if (laForm.cso_libelle_court.value == "") {
		message+="\n\t-Libelle court obligatoire";
		suite=false
	}
	if (laForm.cso_libelle.value == "") {
		message+="\n\t-Libelle obligatoire";
		suite=false
	}
	
	if (suite) {
		laForm.lAction.value=action;
		laForm.submit();
	}
	else {
		alert(message);
	}
}	

function supCso(id) {
	laForm=document.formCso;
	if (confirm('Etes vous sur de vouloir supprimer ce champ')) {
		laForm.lAction.value="SupCso";
        laForm.cso_id.value=id;
        laForm.submit();
	}
}

function display_cso_maj(val) {

	var eltSelect = document.formCso.cso_mode_saisie;
	makeOptionForm(val['modes_saisie'], 0, 1, val['cso_mode_saisie'],eltSelect);
	display_formulaire(val, document.formCso);
	enableDisplay('maj_cso');
	var repr="<input  type='button' value='Modifier' class='button'  ";
	repr+=" onclick=\"valideSaisieCso(this.form,'ModifCso')\"/>";
	repr+="&nbsp;&nbsp;&nbsp;&nbsp;";
	repr+="<input type='button' value='Reset' ";
	repr+=" onclick='x_return_cso_ajax("+val['cso_id']+", display_cso_maj)' class='button' />";
	repr+="&nbsp;&nbsp;&nbsp;&nbsp;";
	repr+="<input type='submit' value='Nouveau' name='newCso' class='button' />";

	//alert(repr);
	getElement("barreActionCso").innerHTML=repr; 
	document.location.href="#top";
}

//-->
</script>
	<fieldset>
	<legend> Gestion des champs de l'ouvrage</legend>
	
	    <center class="maj">
    	<h3>Modification ou ajout des champs de l'ouvrage.	
    		<img src="Images/iconePlus.png" id="iconemaj_lien" border="0" 
    			onclick="inverseDisplay('maj_cso')"style="cursor:pointer" />
    	</h3>
    	<div style="position:relative; width:100%;" >
    	<div id="maj_cso" style="display:none;position:abslolute;left:0" >
    	<form action="actions/ouvrageType_actions.php" name="formCso" method='POST' >
		    <?makeURL_FORM(sizeof($_POST) > 0 ? $_POST : $_GET);?>
			<input type=hidden name="lAction" value="" />
            <input type=hidden name="cso_id" value="" />
            <input type=hidden name="cso_id_tyo" value="<?=$GET_tyo_id?>" />
            	<table width='100%'>
                	<tr>
						<td width="10%" class="titrow">Libelle court</td>
                        <td width="40%" class="tabl0"  >
                        	<input type=text  name="cso_libelle_court" size="20" maxlength="20" />
                        </td>
						<td width="10%" class="titrow">Libelle long</td>
                        <td width="40%" class="tabl0" >
                        	<input type=text  name="cso_libelle" size="50" maxlength="200" />
                        </td>
					</tr>
                    <tr>
                    	<td class="titrow">Valeur Défaut</td>
                        <td class="tabl0" >
                        	<input type=text  name="cso_val_defaut" size="30" maxlength="50" />
						</td>
						<td class="titrow">Mode saisie</td>
                        <td class="tabl0" >
                        	<select name="cso_mode_saisie" onchange="this.className='change'">
                        	<?=makeOption(array('select','libre'), "","", "select")?>
							</select>
						</td>
					</tr>
                    <tr>
						<td class="titrow">Type Donnée</td>
                        <td class="tabl0" >
                        	<select name="cso_type_data" onchange="this.className='change'">
                        	<?=makeOption(array('char','decimal'), "","", "char")?>
							</select>
						</td>
					</tr>
				</table>
				<br/>
				<div id="barreActionCso" class="maj">
					<input type="button" value="Déposer" class="button" onclick="valideSaisieCso(this.form,'AjoutCso')"/>
					&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="reset" value="Annuler" class="button" />
				</div>
				<br/>
		</form>
		</div>
		</div>
	</center>
            
	<center>
		<table width='80%'> 
			<tr class="tabl0">
               	<td class="tittab" width="15%" >
                   	 Libelle court
                </td>
                <td class="tittab" width="65%">
                	Libelle long
                </td>
                <td class="tittab" width="10%">
                	Mode saisie
                </td>
                <td class="tittab" width="10%">
                	Type Donnée
                </td>
                <td>
                	<center>
                	<form action="actions/ouvrageType_actions.php" name="formCsoAdd" method='POST' >
		    		<?makeURL_FORM(sizeof($_POST) > 0 ? $_POST : $_GET);?>
		    			<input type='hidden' value='Nouveau' name='newCso' />
		    			<input type=hidden name="cso_id_tyo" value="<?=$GET_tyo_id?>" />
                		<img src="Images/iconePlus.png" id="iconemaj_lien" border="0" 
    						onclick="document.formCsoAdd.submit()"style="cursor:pointer" />
    				</form>
    				</center>
    			</td>
    			<td></td>
			</tr>     	
	<?php foreach ($tabCso as $val) {?>
			<tr class="tabl0">
               	<td >
                   	 <?=$val['cso_libelle_court']?>
                </td>
                <td  >
                	<?=$val['cso_libelle']?>
                </td>
                <td >
                	<?=$val['cso_mode_saisie']?>
                </td>
                <td >
                	<?=$val['cso_type_data']?>
                </td>
                <td width="5%">
					<table width=100% class="maj">
                    	<tr>
                        	<td valign="top"  align="center" width="5%">
                            <img src="Images/b_drop.png" border="0" title="Effacer le champ d'ouvrage" 
                            	alt="Effacer le cso"  
                            	onclick="supCso('<?=$val['cso_id']?>')"
                            	class="link" />
	                        </td>
    	                    <td valign="top" align="center" width="5%" >
                            	<img src="Images/b_edit.png" border="0"
                            		alt="Modifier"  title="Modifier"
                            		onclick="x_return_cso_ajax('<?=$val['cso_id']?>', display_cso_maj)"
                            		class="link" />
        	                </td>
                        </tr>
            		</table>
            	</td>
            	<td width="5%">
					<img src="Images/data.gif" border="0" title="Détail des datas" 
                    	alt="Zoom data"  
                        onclick="location.href='<?=makeURL_GET(array("mod" => $GET_mod,"rub" => $GET_rub,"option" => "gestionCho"),"cso_id=".$val['cso_id']."&niv_page=".($GET_niv_page+1)."&titre=Détail des données");?>'"
                        class="link" />
	                
            	</td>
            	
			</tr>
   	<?php }?>
   		</table>
   	</center>
	</fieldset>
