<?php
function return_news($id) {
	$row =null;
	if ($id){
		$requete2 = " SELECT * from  ".CFG_PREFIXE_TABLE."newsletter ";
		$requete2 .= " where new_id = ".$id;
		$resultat = mysql_query($requete2);
		$i=0;

		$row = mysql_fetch_array($resultat, MYSQL_ASSOC);

		if ($row) {
			$requete2 = " SELECT ".CFG_PREFIXE_TABLE."rubrique.* from  ".CFG_PREFIXE_TABLE."news_rubrique,  ".CFG_PREFIXE_TABLE."rubrique";
			$requete2 .= " where ner_id_news = ".$id;
			$requete2 .= " and ner_id_rub = rub_id ";
			if (!$resultat = mysql_query($requete2)) {
				echo "erreur sur $requete2 ".mysql_error()."<br/>";
			}
			$i=0;
			while ($row1 = mysql_fetch_array($resultat, MYSQL_ASSOC)) {
				$row['ner'][$row1['rub_id']]=$row1;
			}
		}

	}

	return $row;
}

function return_newFromMail($mail) {
	$row =null;
	if ($mail){
		$requete2 = " SELECT * from  ".CFG_PREFIXE_TABLE."newsletter ";
		$requete2 .= " where new_email = '".$mail."'";

		if (!$resultat = mysql_query($requete2)) {
			echo "erreur sur $requete2 ".mysql_error()."<br/>";
		}
		else {
			$row = mysql_fetch_array($resultat, MYSQL_ASSOC);
		}
	}
	return $row;
}


function add_rubrique($idNews, $idRub) {
	$requete2 = " insert  into ".CFG_PREFIXE_TABLE."news_rubrique ";
	$requete2 .= " values ($idNews, $idRub)";
	if (!$resultat = mysql_query($requete2)) {
		echo "erreur sur $requete2 ".mysql_error()."<br/>";
	}
}

function sup_rubrique($idNews, $idRub) {
	$requete2 = " delete from  ".CFG_PREFIXE_TABLE."news_rubrique ";
	$requete2 .= " where ner_id_news  = $idNews ";
	$requete2 .= " and ner_id_rub = $idRub ";
	if (!$resultat = mysql_query($requete2)) {
		echo "erreur sur $requete2 ".mysql_error()."<br/>";
	}
}

function return_allNews() {
	$row =null;
	$requete2 = " SELECT * from  ".CFG_PREFIXE_TABLE."newsletter ";
	$resultat = mysql_query($requete2);

	$index=0;

	$tabRet=array();
	while ($row = mysql_fetch_array($resultat, MYSQL_ASSOC)) {
		$requete2 = " SELECT ".CFG_PREFIXE_TABLE."rubrique.* from  ".CFG_PREFIXE_TABLE."news_rubrique,  ".CFG_PREFIXE_TABLE."rubrique";
		$requete2 .= " where ner_id_news = ".$row['new_id'];
		$requete2 .= " and ner_id_rub = rub_id ";
		if (!$resultat2 = mysql_query($requete2)) {
			echo "erreur sur $requete2 ".mysql_error()."<br/>";
		}
		$tabRet[$index]=$row;
		while ($row1 = mysql_fetch_array($resultat2, MYSQL_ASSOC)) {
			$tabRet[$index][$row1['rub_id']]=$row1;
		}
		$index++;

	}

	return $tabRet;
}
?>