<?php
$module="gestionconf";
/**
 * retourne toutes les applets possibles pour un bloc
 * liste des fichiers dans le repertoire $bloc en retirant _$bloc.php
 * @param unknown_type $bloc
 * @return unknown_type
 */
function return_appletsFromBloc($bloc) {
  $tabApplets =array();
  $index=0;
  $rep=$bloc;
  $trouve=false;
  for ($index = 0; $index <4; $index++) {
    if (!is_dir($rep)) {
      $rep = "../".$rep ;
    }
    else {
      $trouve=true;
      break;
    }
  }

  if ($trouve && $handle = opendir($rep)) {
    while (false !== ($file = readdir($handle))) {
      if ($file != "." && $file != "..") {
        if (preg_match("[_".$bloc.".php]", $file) > 0) {
          $applet=str_replace("_".$bloc.".php","",$file);
          $tabApplets[$applet]=$applet;
        }
      }
    }
    closedir($handle);
  }
  $trouve=false;
  $rep=$bloc;
    
  // recherche pour l'utilsateur
  for ($index = 0; $index <4; $index++) {
    if (!is_dir($rep)) {
      $rep = "../userfiles/modules/".$bloc ;
    }
    else {
      $trouve=true;
      break;
    }
  }

  if ($trouve && $handle = opendir($rep)) {
    while (false !== ($file = readdir($handle))) {
      if ($file != "." && $file != "..") {
        if (preg_match("[_user_".$bloc.".html]", $file) > 0) {
          $applet=str_replace("_".$bloc.".html","",$file);
          $tabApplets[$applet]=$applet;
        }
      }
    }
    closedir($handle);
  }


  if ($bloc == "coteG" ||  $bloc == "coteD") {
    $trouve=false;
    $bloc="cote";
    $rep=$bloc;
    for ($index = 0; $index <4; $index++) {
      if (!is_dir($rep)) {
        $rep = "../".$rep ;
      }
      else {
        $trouve=true;
        break;
      }
    }

    if ($trouve &&  $handle = opendir($rep)) {
      while (false !== ($file = readdir($handle))) {
        if ($file != "." && $file != "..") {
          if (preg_match("[_".$bloc.".php]", $file) > 0) {
            $applet=str_replace("_".$bloc.".php","",$file);
            $tabApplets[$applet]=$applet;
          }
        }
      }
      closedir($handle);
    } 
    $trouve=false;
    $rep="cote";
    // recherche pour l'utilsateur
    for ($index = 0; $index <4; $index++) {
      if (!is_dir($rep)) {
        $rep = "../userfiles/modules/".$bloc ;
      }
      else {
        $trouve=true;
        break;
      }
    }

    if ($trouve && $handle = opendir($rep)) {
     // echo $rep;
      while (false !== ($file = readdir($handle))) {
        if ($file != "." && $file != "..") {
          if (preg_match("[_user_".$bloc.".html]", $file) > 0) {
            $applet=str_replace("_".$bloc.".html","",$file);
            $tabApplets[$applet]=$applet;
          }
        }
      }
      closedir($handle);
    }

  }

  sort($tabApplets);
  return $tabApplets;
}
?>